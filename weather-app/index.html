<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; }
        .search { display: flex; justify-content: center; margin-bottom: 20px; }
        input { padding: 10px; flex: 1; min-width: 200px; border: none; border-radius: 5px 0 0 5px; font-size: 16px; }
        button { padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 0 5px 5px 0; cursor: pointer; flex-shrink: 0; }
        .current-weather { background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; margin-bottom: 20px; display: grid; grid-template-columns: 1fr 2fr; gap: 20px; align-items: center; }
        .weather-icon { font-size: 5rem; text-align: center; }
        .weather-details h2 { margin: 0; }
        .forecast { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
        .forecast-item { background: rgba(255,255,255,0.2); padding: 10px; border-radius: 10px; text-align: center; }
        .unit-toggle { text-align: center; margin-bottom: 20px; }
        .unit-toggle button { margin: 0 10px; padding: 5px 10px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 5px; color: #333; cursor: pointer; }
        .unit-toggle button.active { background: #007bff; color: white; }
    
        .city-select { margin-bottom: 20px; text-align: center; }
        select { padding: 10px; border-radius: 5px; border: 1px solid #ddd; font-size: 16px; }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            input {
                min-width: 150px;
            }
            .current-weather {
                grid-template-columns: 1fr;
                text-align: center;
            }
            .weather-icon {
                font-size: 3rem;
            }
            .forecast {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            .forecast-item {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center;"><i class="fas fa-cloud-sun"></i> Weather App</h1>
        <div class="search">
            <input type="text" id="city-input" placeholder="Enter city name">
            <button onclick="getWeather()"><i class="fas fa-search"></i> Search</button>
        </div>
        <div class="unit-toggle">
            <button id="celsius" class="active" onclick="setUnit('metric')">°C</button>
            <button id="fahrenheit" onclick="setUnit('imperial')">°F</button>
        </div>
        <div class="city-select" id="city-select" style="display: none;">
            <select id="city-dropdown" onchange="selectCity()">
                <option value="">Select a city</option>
            </select>
        </div>
        <div id="current-weather" class="current-weather" style="display: none;"></div>
        <div id="forecast" class="forecast" style="display: none;"></div>
    </div>

    <script>
        let unit = 'metric';
        let geoResults = [];

        function setUnit(newUnit) {
            unit = newUnit;
            document.getElementById('celsius').classList.toggle('active', unit === 'metric');
            document.getElementById('fahrenheit').classList.toggle('active', unit === 'imperial');
            const city = document.getElementById('city-input').value;
            if (city) getWeather();
        }

        async function getWeather() {
            const city = document.getElementById('city-input').value;
            if (!city) return;

            try {
                const geoResponse = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=5&language=en&format=json`);
                const geoData = await geoResponse.json();
                if (!geoData.results || geoData.results.length === 0) throw new Error('City not found');

                geoResults = geoData.results;
                if (geoResults.length === 1) {
                    await getWeatherForCity(geoResults[0]);
                } else {
                    showCitySelection();
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function showCitySelection() {
            const select = document.getElementById('city-dropdown');
            select.innerHTML = '<option value="">Select a city</option>';
            geoResults.forEach((result, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${result.name}, ${result.country}`;
                select.appendChild(option);
            });
            document.getElementById('city-select').style.display = 'block';
        }

        async function selectCity() {
            const index = document.getElementById('city-dropdown').value;
            if (index !== '') {
                await getWeatherForCity(geoResults[index]);
                document.getElementById('city-select').style.display = 'none';
            }
        }

        async function getWeatherForCity(cityData) {
            const { latitude, longitude, name, country } = cityData;
            try {
                const weatherResponse = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,wind_speed_10m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto`);
                const weatherData = await weatherResponse.json();

                displayCurrentWeather(weatherData, name, country);
                displayForecast(weatherData);
            } catch (error) {
                alert('Error fetching weather data: ' + error.message);
            }
        }

        function displayCurrentWeather(data, name, country) {
            const temp = unit === 'metric' ? data.current.temperature_2m : (data.current.temperature_2m * 9/5) + 32;
            const tempUnit = unit === 'metric' ? '°C' : '°F';
            const windUnit = unit === 'metric' ? 'km/h' : 'mph';
            const wind = unit === 'metric' ? data.current.wind_speed_10m * 3.6 : data.current.wind_speed_10m; // Convert m/s to km/h or mph

            const html = `
                <div class="weather-icon">
                    <i class="fas fa-${getWeatherIcon(data.current.weather_code)}"></i>
                </div>
                <div class="weather-details">
                    <h2>${name}, ${country}</h2>
                    <p>Temperature: ${Math.round(temp)}${tempUnit}</p>
                    <p>Wind: ${Math.round(wind)} ${windUnit}</p>
                    <p>${getWeatherDescription(data.current.weather_code)}</p>
                </div>
            `;
            document.getElementById('current-weather').innerHTML = html;
            document.getElementById('current-weather').style.display = 'grid';

            // Change background based on weather
            document.body.style.background = getBackgroundGradient(data.current.weather_code);
        }

        function displayForecast(data) {
            const tempUnit = unit === 'metric' ? '°C' : '°F';
            const html = data.daily.time.slice(0, 5).map((date, index) => {
                const maxTemp = unit === 'metric' ? data.daily.temperature_2m_max[index] : (data.daily.temperature_2m_max[index] * 9/5) + 32;
                const minTemp = unit === 'metric' ? data.daily.temperature_2m_min[index] : (data.daily.temperature_2m_min[index] * 9/5) + 32;
                return `
                    <div class="forecast-item">
                        <p>${new Date(date).toLocaleDateString()}</p>
                        <i class="fas fa-${getWeatherIcon(data.daily.weather_code[index])}"></i>
                        <p>${Math.round(maxTemp)}/${Math.round(minTemp)}${tempUnit}</p>
                        <p>${getWeatherDescription(data.daily.weather_code[index])}</p>
                    </div>
                `;
            }).join('');

            document.getElementById('forecast').innerHTML = html;
            document.getElementById('forecast').style.display = 'grid';
        }

        function getWeatherIcon(code) {
            if (code === 0) return 'sun';
            if (code >= 1 && code <= 3) return 'cloud-sun';
            if (code >= 45 && code <= 48) return 'smog';
            if (code >= 51 && code <= 55) return 'cloud-rain';
            if (code >= 56 && code <= 57) return 'snowflake';
            if (code >= 61 && code <= 65) return 'cloud-showers-heavy';
            if (code >= 66 && code <= 67) return 'snowflake';
            if (code >= 71 && code <= 75) return 'snowflake';
            if (code >= 77) return 'snowflake';
            if (code >= 80 && code <= 82) return 'cloud-rain';
            if (code >= 85 && code <= 86) return 'snowflake';
            if (code >= 95) return 'bolt';
            return 'cloud';
        }

        function getWeatherDescription(code) {
            const descriptions = {
                0: 'Clear sky',
                1: 'Mainly clear',
                2: 'Partly cloudy',
                3: 'Overcast',
                45: 'Fog',
                48: 'Depositing rime fog',
                51: 'Light drizzle',
                53: 'Moderate drizzle',
                55: 'Dense drizzle',
                56: 'Light freezing drizzle',
                57: 'Dense freezing drizzle',
                61: 'Slight rain',
                63: 'Moderate rain',
                65: 'Heavy rain',
                66: 'Light freezing rain',
                67: 'Heavy freezing rain',
                71: 'Slight snow fall',
                73: 'Moderate snow fall',
                75: 'Heavy snow fall',
                77: 'Snow grains',
                80: 'Slight rain showers',
                81: 'Moderate rain showers',
                82: 'Violent rain showers',
                85: 'Slight snow showers',
                86: 'Heavy snow showers',
                95: 'Thunderstorm',
                96: 'Thunderstorm with slight hail',
                99: 'Thunderstorm with heavy hail'
            };
            return descriptions[code] || 'Unknown';
        }

        function getBackgroundGradient(code) {
            if (code === 0) return 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)'; // Sunny - warm colors
            if (code >= 1 && code <= 3) return 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'; // Cloudy - light blue
            if (code >= 45 && code <= 48) return 'linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)'; // Fog - misty
            if (code >= 51 && code <= 67) return 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; // Rain - blue
            if (code >= 71 && code <= 86) return 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)'; // Snow - cold
            if (code >= 95) return 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)'; // Thunder - stormy
            return 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; // Default
        }
    </script>
</body>
</html>